services:
  front-dev:
    container_name: front-dev
    build:
      context: frontend/
      target: dev
    env_file:
      - frontend/.env
    environment:
      - node_env=development
    ports:
      - "2000:2000"
    volumes:
      - ./frontend:/app
      - /app/node_modules
        # Add certificates if your backend also uses HTTPS
      - ~/.certs/localhost.pem:/etc/nginx/ssl/nginx-selfsigned.crt:ro
      - ~/.certs/localhost-key.pem:/etc/nginx/ssl/nginx-selfsigned.key:ro
    profiles:
      - dev
  front-prod:
    container_name: front-prod
    build:
      context: frontend/
      target: prod
    env_file:
      - frontend/.env
    environment:
      - node_env=production
    ports:
      - "2000:2000"
      - "80:80"
    volumes:
      - ~/.certs/localhost.pem:/etc/nginx/ssl/nginx-selfsigned.crt:ro
      - ~/.certs/localhost-key.pem:/etc/nginx/ssl/nginx-selfsigned.key:ro
    profiles:
      - prod

  back-dev:
    container_name: back-dev
    build:
      context: backend/server/
      target: dev
    env_file:
      - backend/server/.env
    environment:
      - node_env=development
    ports:
      - "4000:4000"
    volumes:
      - ./backend/server:/app
      - /app/node_modules
      - ./backend/server/database:/app/database
      - ~/.certs/localhost.pem:/etc/certs/selfsigned.crt:ro
      - ~/.certs/localhost-key.pem:/etc/certs/selfsigned.key:ro
    profiles:
      - dev
  back-prod:
    container_name: back-prod
    build:
      context: backend/server/
      target: prod
    env_file:
      - backend/server/.env
    environment:
      - node_env=production
    ports:
      - "4000:4000"
    volumes:
      - ~/.certs/localhost.pem:/etc/certs/selfsigned.crt:ro
      - ~/.certs/localhost-key.pem:/etc/certs/selfsigned.key:ro
    profiles:
      - prod
